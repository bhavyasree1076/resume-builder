<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Builder - Create Professional Resumes</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- jsPDF and html2canvas for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* Custom styles for print and PDF */
        .resume-print-container {
            print-color-adjust: exact;
            -webkit-print-color-adjust: exact;
            color-adjust: exact;
        }
        
        /* Ensure text stays within container bounds */
        .resume-print-container .bg-gradient-to-r {
            overflow: hidden;
            word-wrap: break-word;
            hyphens: auto;
            max-width: 100%;
            box-sizing: border-box;
            display: block;
        }
        
        .resume-print-container .text-white {
            overflow-wrap: break-word;
            word-break: break-word;
            max-width: 100%;
            box-sizing: border-box;
        }
        
        .resume-print-container .bg-gray-800 {
            overflow: hidden;
            word-wrap: break-word;
            hyphens: auto;
            max-width: 100%;
            box-sizing: border-box;
            display: block;
        }
        
        .resume-print-container .container {
            max-width: 100%;
            padding-left: 1rem;
            padding-right: 1rem;
            box-sizing: border-box;
        }
        
        /* Additional text overflow protection */
        .resume-print-container .break-words {
            word-wrap: break-word;
            overflow-wrap: break-word;
            box-sizing: border-box;
        }
        
        .resume-print-container .break-all {
            word-break: break-all;
            overflow-wrap: break-word;
            box-sizing: border-box;
        }
        
        .resume-print-container .flex-shrink-0 {
            flex-shrink: 0;
        }
        
        /* Ensure proper container boundaries */
        .resume-print-container .overflow-hidden {
            overflow: hidden !important;
        }
        
        .resume-print-container .relative {
            position: relative;
        }
        
        .resume-print-container .absolute {
            position: absolute;
        }
        
        /* Fix gradient backgrounds for PDF */
        .resume-print-container .bg-gradient-to-r.from-blue-600.to-blue-800 {
            background: linear-gradient(to right, #2563eb, #1e40af) !important;
        }
        
        .resume-print-container .bg-gradient-to-r.from-purple-600.via-pink-600.to-red-600 {
            background: linear-gradient(to right, #9333ea, #db2777, #dc2626) !important;
        }
        
        @media print {
            .resume-print-container {
                width: 100% !important;
                max-width: none !important;
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
                box-shadow: none !important;
                border-radius: 0 !important;
            }
            
            .resume-print-container *,
            .resume-print-container *:before,
            .resume-print-container *:after {
                print-color-adjust: exact !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            .resume-print-container .bg-gradient-to-r.from-blue-600.to-blue-800 {
                background: linear-gradient(to right, #2563eb, #1e40af) !important;
                print-color-adjust: exact !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            .resume-print-container .bg-gradient-to-r.from-purple-600.via-pink-600.to-red-600 {
                background: linear-gradient(to right, #9333ea, #db2777, #dc2626) !important;
                print-color-adjust: exact !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
            
            .resume-print-container .text-blue-600 { color: #2563eb !important; }
            .resume-print-container .text-purple-600 { color: #9333ea !important; }
            .resume-print-container .text-pink-600 { color: #db2777 !important; }
            .resume-print-container .text-gray-800 { color: #1f2937 !important; }
            .resume-print-container .text-gray-700 { color: #374151 !important; }
            .resume-print-container .text-gray-600 { color: #4b5563 !important; }
            .resume-print-container .text-white { color: #ffffff !important; }
            
            .resume-print-container .bg-blue-600 { background-color: #2563eb !important; }
            .resume-print-container .bg-purple-600 { background-color: #9333ea !important; }
            .resume-print-container .bg-pink-600 { background-color: #db2777 !important; }
            .resume-print-container .bg-gray-800 { background-color: #1f2937 !important; }
            .resume-print-container .bg-white { background-color: #ffffff !important; }
            
            .resume-print-container .border-blue-600 { border-color: #2563eb !important; }
            .resume-print-container .border-gray-800 { border-color: #1f2937 !important; }
            .resume-print-container .border-gray-300 { border-color: #d1d5db !important; }
            
            .no-print {
                display: none !important;
            }
        }
        
        /* Hide template selector by default */
        .template-selector {
            display: none;
        }
        
        .template-selector.active {
            display: block;
        }
        
        /* Loading spinner */
        .spinner {
            border: 2px solid #ffffff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Toast notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1f2937;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 9999;
            font-family: system-ui, -apple-system, sans-serif;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .toast.success {
            background: #059669;
        }
        
        .toast.error {
            background: #dc2626;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <div class="container mx-auto py-8 px-4">
        <div class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">Resume Builder</h1>
            <p class="text-lg text-gray-600 mb-6">Create professional resumes in minutes</p>
            
            <!-- Action Buttons -->
            <div class="flex flex-wrap justify-center gap-4 mb-6">
                <button onclick="saveResume()" class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 flex items-center gap-2">
                    <i data-lucide="save" class="w-4 h-4"></i>
                    Save Resume
                </button>
                
                <button onclick="toggleTemplateSelector()" class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 flex items-center gap-2">
                    <i data-lucide="layout" class="w-4 h-4"></i>
                    Change Template
                </button>
                
                <button onclick="loadSavedResumes()" class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 flex items-center gap-2">
                    <i data-lucide="folder-open" class="w-4 h-4"></i>
                    My Resumes (<span id="resume-count">0</span>)
                </button>
            </div>
            
            <!-- Template Selector -->
            <div id="template-selector" class="template-selector max-w-4xl mx-auto mb-6">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Choose a Template</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <button onclick="selectTemplate('modern')" class="template-option border-2 border-blue-500 rounded-lg p-4 hover:bg-blue-50 transition-colors">
                            <div class="bg-gradient-to-r from-blue-600 to-blue-800 h-20 rounded mb-2"></div>
                            <h3 class="font-semibold">Modern</h3>
                            <p class="text-sm text-gray-600">Clean & Professional</p>
                        </button>
                        
                        <button onclick="selectTemplate('classic')" class="template-option border-2 border-gray-300 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                            <div class="bg-gray-800 h-20 rounded mb-2"></div>
                            <h3 class="font-semibold">Classic</h3>
                            <p class="text-sm text-gray-600">Traditional & Timeless</p>
                        </button>
                        
                        <button onclick="selectTemplate('creative')" class="template-option border-2 border-gray-300 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                            <div class="bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 h-20 rounded mb-2"></div>
                            <h3 class="font-semibold">Creative</h3>
                            <p class="text-sm text-gray-600">Bold & Expressive</p>
                        </button>
                        
                        <button onclick="selectTemplate('minimal')" class="template-option border-2 border-gray-300 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                            <div class="bg-white border-2 border-gray-300 h-20 rounded mb-2"></div>
                            <h3 class="font-semibold">Minimal</h3>
                            <p class="text-sm text-gray-600">Simple & Elegant</p>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="flex justify-center mb-6">
            <div class="bg-white rounded-lg shadow-sm p-1 flex">
                <button onclick="switchTab('edit')" id="edit-tab" class="px-6 py-2 rounded-md bg-blue-600 text-white flex items-center gap-2">
                    <i data-lucide="edit" class="w-4 h-4"></i>
                    Edit Resume
                </button>
                <button onclick="switchTab('preview')" id="preview-tab" class="px-6 py-2 rounded-md text-gray-600 hover:text-gray-800 flex items-center gap-2">
                    <i data-lucide="eye" class="w-4 h-4"></i>
                    Preview
                </button>
            </div>
        </div>

        <!-- Edit Tab -->
        <div id="edit-tab-content" class="space-y-6">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Personal Information</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                        <input type="text" id="fullName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="John Doe">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                        <input type="email" id="email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="john@example.com">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone</label>
                        <input type="tel" id="phone" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="+1 (555) 123-4567">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                        <input type="text" id="location" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="New York, NY">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Website</label>
                        <input type="url" id="website" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="https://johndoe.com">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">LinkedIn</label>
                        <input type="url" id="linkedin" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="https://linkedin.com/in/johndoe">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">GitHub</label>
                        <input type="url" id="github" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="https://github.com/johndoe">
                    </div>
                </div>
                
                <div class="mt-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Professional Summary</label>
                    <textarea id="summary" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="A brief summary of your professional background and expertise..."></textarea>
                </div>
            </div>
            
            <!-- Experience Section -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Work Experience</h2>
                    <button onclick="addExperience()" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center gap-2">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        Add Experience
                    </button>
                </div>
                
                <div id="experience-list" class="space-y-4">
                    <!-- Experience items will be added here -->
                </div>
            </div>
            
            <!-- Education Section -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Education</h2>
                    <button onclick="addEducation()" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center gap-2">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        Add Education
                    </button>
                </div>
                
                <div id="education-list" class="space-y-4">
                    <!-- Education items will be added here -->
                </div>
            </div>
            
            <!-- Skills Section -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Skills</h2>
                    <button onclick="addSkill()" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center gap-2">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        Add Skill
                    </button>
                </div>
                
                <div id="skills-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Skills will be added here -->
                </div>
            </div>
        </div>

        <!-- Preview Tab -->
        <div id="preview-tab-content" class="hidden">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Resume Preview</h2>
                    <div class="flex gap-2">
                        <button onclick="exportToPDF()" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center gap-2">
                            <i data-lucide="download" class="w-4 h-4"></i>
                            Export as PDF
                        </button>
                        <button onclick="printResume()" class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 flex items-center gap-2">
                            <i data-lucide="printer" class="w-4 h-4"></i>
                            Print
                        </button>
                    </div>
                </div>
                
                <div id="resume-content" class="resume-print-container">
                    <!-- Resume preview will be rendered here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Saved Resumes Modal -->
    <div id="saved-resumes-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-2xl w-full max-h-96 overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">My Saved Resumes</h2>
                        <button onclick="closeSavedResumes()" class="text-gray-500 hover:text-gray-700">
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                    </div>
                    
                    <div id="saved-resumes-list" class="space-y-4">
                        <!-- Saved resumes will be listed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Resume data state
        let resumeData = {
            title: 'My Resume',
            fullName: '',
            email: '',
            phone: '',
            location: '',
            website: '',
            linkedin: '',
            github: '',
            summary: '',
            experience: [],
            education: [],
            skills: [],
            projects: [],
            certifications: [],
            languages: [],
            template: 'modern'
        };

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            loadResumeData();
            updateResumePreview();
            updateResumeCount();
        });

        // Tab switching
        function switchTab(tab) {
            const editTab = document.getElementById('edit-tab');
            const previewTab = document.getElementById('preview-tab');
            const editContent = document.getElementById('edit-tab-content');
            const previewContent = document.getElementById('preview-tab-content');

            if (tab === 'edit') {
                editTab.classList.add('bg-blue-600', 'text-white');
                editTab.classList.remove('text-gray-600');
                previewTab.classList.remove('bg-blue-600', 'text-white');
                previewTab.classList.add('text-gray-600');
                editContent.classList.remove('hidden');
                previewContent.classList.add('hidden');
            } else {
                previewTab.classList.add('bg-blue-600', 'text-white');
                previewTab.classList.remove('text-gray-600');
                editTab.classList.remove('bg-blue-600', 'text-white');
                editTab.classList.add('text-gray-600');
                previewContent.classList.remove('hidden');
                editContent.classList.add('hidden');
                updateResumePreview();
            }
        }

        // Template selector
        function toggleTemplateSelector() {
            const selector = document.getElementById('template-selector');
            selector.classList.toggle('active');
        }

        function selectTemplate(template) {
            resumeData.template = template;
            updateResumePreview();
            toggleTemplateSelector();
            showToast(`Template changed to ${template}`, 'success');
        }

        // Form data handling
        function loadResumeData() {
            // Load from inputs
            const inputs = ['fullName', 'email', 'phone', 'location', 'website', 'linkedin', 'github', 'summary'];
            inputs.forEach(field => {
                const element = document.getElementById(field);
                if (element) {
                    element.addEventListener('input', function() {
                        resumeData[field] = this.value;
                    });
                }
            });
        }

        // Experience management
        function addExperience() {
            const experience = {
                id: Date.now(),
                position: '',
                company: '',
                startDate: '',
                endDate: '',
                current: false,
                description: ''
            };
            resumeData.experience.push(experience);
            renderExperienceList();
        }

        function renderExperienceList() {
            const container = document.getElementById('experience-list');
            container.innerHTML = '';

            resumeData.experience.forEach((exp, index) => {
                const expDiv = document.createElement('div');
                expDiv.className = 'border border-gray-200 rounded-lg p-4';
                expDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-lg font-semibold">Experience ${index + 1}</h3>
                        <button onclick="removeExperience(${exp.id})" class="text-red-600 hover:text-red-800">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Position</label>
                            <input type="text" value="${exp.position}" onchange="updateExperience(${exp.id}, 'position', this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Software Engineer">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Company</label>
                            <input type="text" value="${exp.company}" onchange="updateExperience(${exp.id}, 'company', this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Tech Company">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                            <input type="month" value="${exp.startDate}" onchange="updateExperience(${exp.id}, 'startDate', this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                            <input type="month" value="${exp.endDate}" onchange="updateExperience(${exp.id}, 'endDate', this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" ${exp.current ? 'disabled' : ''}>
                            <label class="flex items-center mt-2">
                                <input type="checkbox" ${exp.current ? 'checked' : ''} onchange="updateExperience(${exp.id}, 'current', this.checked)" class="mr-2">
                                <span class="text-sm">Currently working here</span>
                            </label>
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea rows="3" onchange="updateExperience(${exp.id}, 'description', this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Describe your responsibilities and achievements...">${exp.description}</textarea>
                    </div>
                `;
                container.appendChild(expDiv);
            });
            
            lucide.createIcons();
        }

        function updateExperience(id, field, value) {
            const exp = resumeData.experience.find(e => e.id === id);
            if (exp) {
                exp[field] = value;
                if (field === 'current' && value) {
                    exp.endDate = '';
                }
            }
        }

        function removeExperience(id) {
            resumeData.experience = resumeData.experience.filter(e => e.id !== id);
            renderExperienceList();
        }

        // Education management
        function addEducation() {
            const education = {
                id: Date.now(),
                degree: '',
                field: '',
                institution: '',
                startDate: '',
                endDate: '',
                gpa: ''
            };
            resumeData.education.push(education);
            renderEducationList();
        }

        function renderEducationList() {
            const container = document.getElementById('education-list');
            container.innerHTML = '';

            resumeData.education.forEach((edu, index) => {
                const eduDiv = document.createElement('div');
                eduDiv.className = 'border border-gray-200 rounded-lg p-4';
                eduDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-lg font-semibold">Education ${index + 1}</h3>
                        <button onclick="removeEducation(${edu.id})" class="text-red-600 hover:text-red-800">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Degree</label>
                            <input type="text" value="${edu.degree}" onchange="updateEducation(${edu.id}, 'degree', this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Bachelor of Science">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Field of Study</label>
                            <input type="text" value="${edu.field}" onchange="updateEducation(${edu.id}, 'field', this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Computer Science">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Institution</label>
                            <input type="text" value="${edu.institution}" onchange="updateEducation(${edu.id}, 'institution', this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="University Name">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">GPA (Optional)</label>
                            <input type="text" value="${edu.gpa}" onchange="updateEducation(${edu.id}, 'gpa', this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="3.8">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                            <input type="month" value="${edu.startDate}" onchange="updateEducation(${edu.id}, 'startDate', this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                            <input type="month" value="${edu.endDate}" onchange="updateEducation(${edu.id}, 'endDate', this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                `;
                container.appendChild(eduDiv);
            });
            
            lucide.createIcons();
        }

        function updateEducation(id, field, value) {
            const edu = resumeData.education.find(e => e.id === id);
            if (edu) {
                edu[field] = value;
            }
        }

        function removeEducation(id) {
            resumeData.education = resumeData.education.filter(e => e.id !== id);
            renderEducationList();
        }

        // Skills management
        function addSkill() {
            const skill = {
                id: Date.now(),
                name: '',
                category: 'Technical',
                level: 'Intermediate'
            };
            resumeData.skills.push(skill);
            renderSkillsList();
        }

        function renderSkillsList() {
            const container = document.getElementById('skills-list');
            container.innerHTML = '';

            resumeData.skills.forEach((skill, index) => {
                const skillDiv = document.createElement('div');
                skillDiv.className = 'border border-gray-200 rounded-lg p-4';
                skillDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-lg font-semibold">Skill ${index + 1}</h3>
                        <button onclick="removeSkill(${skill.id})" class="text-red-600 hover:text-red-800">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Skill Name</label>
                            <input type="text" value="${skill.name}" onchange="updateSkill(${skill.id}, 'name', this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="JavaScript">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                            <select onchange="updateSkill(${skill.id}, 'category', this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="Technical" ${skill.category === 'Technical' ? 'selected' : ''}>Technical</option>
                                <option value="Soft Skills" ${skill.category === 'Soft Skills' ? 'selected' : ''}>Soft Skills</option>
                                <option value="Languages" ${skill.category === 'Languages' ? 'selected' : ''}>Languages</option>
                                <option value="Tools" ${skill.category === 'Tools' ? 'selected' : ''}>Tools</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Level</label>
                            <select onchange="updateSkill(${skill.id}, 'level', this.value)" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="Beginner" ${skill.level === 'Beginner' ? 'selected' : ''}>Beginner</option>
                                <option value="Intermediate" ${skill.level === 'Intermediate' ? 'selected' : ''}>Intermediate</option>
                                <option value="Advanced" ${skill.level === 'Advanced' ? 'selected' : ''}>Advanced</option>
                                <option value="Expert" ${skill.level === 'Expert' ? 'selected' : ''}>Expert</option>
                            </select>
                        </div>
                    </div>
                `;
                container.appendChild(skillDiv);
            });
            
            lucide.createIcons();
        }

        function updateSkill(id, field, value) {
            const skill = resumeData.skills.find(s => s.id === id);
            if (skill) {
                skill[field] = value;
            }
        }

        function removeSkill(id) {
            resumeData.skills = resumeData.skills.filter(s => s.id !== id);
            renderSkillsList();
        }

        // Resume preview rendering
        function updateResumePreview() {
            const container = document.getElementById('resume-content');
            if (!container) return;

            // Update resume data from form inputs
            const inputs = ['fullName', 'email', 'phone', 'location', 'website', 'linkedin', 'github', 'summary'];
            inputs.forEach(field => {
                const element = document.getElementById(field);
                if (element) {
                    resumeData[field] = element.value;
                }
            });

            // Render based on selected template
            switch (resumeData.template) {
                case 'modern':
                    container.innerHTML = renderModernTemplate();
                    break;
                case 'classic':
                    container.innerHTML = renderClassicTemplate();
                    break;
                case 'creative':
                    container.innerHTML = renderCreativeTemplate();
                    break;
                case 'minimal':
                    container.innerHTML = renderMinimalTemplate();
                    break;
                default:
                    container.innerHTML = renderModernTemplate();
            }
        }

        function renderModernTemplate() {
            return `
                <div class="bg-white shadow-lg rounded-lg overflow-hidden resume-print-container">
                    <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-8 max-w-full">
                        <div class="text-center container mx-auto">
                            <h1 class="text-4xl font-bold mb-2 break-words">${resumeData.fullName || 'Your Name'}</h1>
                            <div class="flex flex-wrap justify-center gap-4 text-sm">
                                ${resumeData.email ? `<div class="flex items-center gap-1 break-all"><i data-lucide="mail" class="w-4 h-4 flex-shrink-0"></i> <span>${resumeData.email}</span></div>` : ''}
                                ${resumeData.phone ? `<div class="flex items-center gap-1 break-all"><i data-lucide="phone" class="w-4 h-4 flex-shrink-0"></i> <span>${resumeData.phone}</span></div>` : ''}
                                ${resumeData.location ? `<div class="flex items-center gap-1 break-all"><i data-lucide="map-pin" class="w-4 h-4 flex-shrink-0"></i> <span>${resumeData.location}</span></div>` : ''}
                            </div>
                            <div class="flex flex-wrap justify-center gap-4 text-sm mt-2">
                                ${resumeData.website ? `<div class="flex items-center gap-1 break-all"><i data-lucide="globe" class="w-4 h-4 flex-shrink-0"></i> <a href="${resumeData.website}" class="hover:underline">${resumeData.website.replace(/^https?:\/\//, '')}</a></div>` : ''}
                                ${resumeData.linkedin ? `<div class="flex items-center gap-1 break-all"><i data-lucide="linkedin" class="w-4 h-4 flex-shrink-0"></i> <a href="${resumeData.linkedin}" class="hover:underline">LinkedIn</a></div>` : ''}
                                ${resumeData.github ? `<div class="flex items-center gap-1 break-all"><i data-lucide="github" class="w-4 h-4 flex-shrink-0"></i> <a href="${resumeData.github}" class="hover:underline">GitHub</a></div>` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="p-8">
                        ${resumeData.summary ? `
                            <section class="mb-8">
                                <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-blue-600 pb-2">Professional Summary</h2>
                                <p class="text-gray-700 leading-relaxed">${resumeData.summary}</p>
                            </section>
                        ` : ''}
                        ${renderExperience()}
                        ${renderEducation()}
                        ${renderSkills()}
                        ${renderProjects()}
                        ${renderCertifications()}
                        ${renderLanguages()}
                    </div>
                </div>
            `;
        }

        function renderClassicTemplate() {
            return `
                <div class="bg-white shadow-lg rounded-lg overflow-hidden border-2 border-gray-800 resume-print-container">
                    <div class="bg-gray-800 text-white p-8 text-center max-w-full">
                        <h1 class="text-4xl font-bold mb-2 break-words">${resumeData.fullName || 'Your Name'}</h1>
                        <div class="text-lg space-y-1">
                            ${resumeData.email ? `<p class="break-all">${resumeData.email}</p>` : ''}
                            ${resumeData.phone ? `<p class="break-all">${resumeData.phone}</p>` : ''}
                            ${resumeData.location ? `<p class="break-all">${resumeData.location}</p>` : ''}
                        </div>
                    </div>
                    <div class="p-8">
                        ${resumeData.summary ? `
                            <section class="mb-8">
                                <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center border-b-2 border-gray-800 pb-2">PROFESSIONAL SUMMARY</h2>
                                <p class="text-gray-700 leading-relaxed text-center">${resumeData.summary}</p>
                            </section>
                        ` : ''}
                        ${renderExperience('classic')}
                        ${renderEducation('classic')}
                        ${renderSkills('classic')}
                        ${renderProjects('classic')}
                        ${renderCertifications('classic')}
                        ${renderLanguages('classic')}
                    </div>
                </div>
            `;
        }

        function renderCreativeTemplate() {
            return `
                <div class="bg-white shadow-lg rounded-lg overflow-hidden resume-print-container">
                    <div class="bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 text-white p-8 max-w-full">
                        <div class="text-center container mx-auto">
                            <h1 class="text-5xl font-bold mb-2 tracking-wide break-words">${resumeData.fullName || 'Your Name'}</h1>
                            <div class="flex flex-wrap justify-center gap-4 text-sm">
                                ${resumeData.email ? `<div class="flex items-center gap-1 break-all"><i data-lucide="mail" class="w-4 h-4 flex-shrink-0"></i> <span>${resumeData.email}</span></div>` : ''}
                                ${resumeData.phone ? `<div class="flex items-center gap-1 break-all"><i data-lucide="phone" class="w-4 h-4 flex-shrink-0"></i> <span>${resumeData.phone}</span></div>` : ''}
                                ${resumeData.location ? `<div class="flex items-center gap-1 break-all"><i data-lucide="map-pin" class="w-4 h-4 flex-shrink-0"></i> <span>${resumeData.location}</span></div>` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="p-8">
                        ${resumeData.summary ? `
                            <section class="mb-8">
                                <h2 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 mb-4">About Me</h2>
                                <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-lg">
                                    <p class="text-gray-700 leading-relaxed text-lg">${resumeData.summary}</p>
                                </div>
                            </section>
                        ` : ''}
                        ${renderExperience()}
                        ${renderEducation()}
                        ${renderSkills()}
                        ${renderProjects()}
                        ${renderCertifications()}
                        ${renderLanguages()}
                    </div>
                </div>
            `;
        }

        function renderMinimalTemplate() {
            return `
                <div class="bg-white shadow-lg rounded-lg overflow-hidden border border-gray-200 resume-print-container">
                    <div class="bg-white text-gray-800 p-8 border-b border-gray-200 max-w-full">
                        <h1 class="text-4xl font-light mb-4 break-words">${resumeData.fullName || 'Your Name'}</h1>
                        <div class="flex flex-wrap gap-6 text-sm text-gray-600">
                            ${resumeData.email ? `<div class="break-all">${resumeData.email}</div>` : ''}
                            ${resumeData.phone ? `<div class="break-all">${resumeData.phone}</div>` : ''}
                            ${resumeData.location ? `<div class="break-all">${resumeData.location}</div>` : ''}
                            ${resumeData.website ? `<div class="break-all"><a href="${resumeData.website}" class="hover:underline">${resumeData.website.replace(/^https?:\/\//, '')}</a></div>` : ''}
                        </div>
                    </div>
                    <div class="p-8">
                        ${resumeData.summary ? `
                            <section class="mb-8">
                                <h2 class="text-xl font-light text-gray-800 mb-4 pb-2 border-b border-gray-300">Summary</h2>
                                <p class="text-gray-700 leading-relaxed">${resumeData.summary}</p>
                            </section>
                        ` : ''}
                        ${renderExperience('minimal')}
                        ${renderEducation('minimal')}
                        ${renderSkills('minimal')}
                        ${renderProjects('minimal')}
                        ${renderCertifications('minimal')}
                        ${renderLanguages('minimal')}
                    </div>
                </div>
            `;
        }

        function renderExperience(style = 'modern') {
            if (!resumeData.experience.length) return '';
            
            const titleClass = style === 'classic' ? 'text-2xl font-bold text-gray-800 mb-4 text-center border-b-2 border-gray-800 pb-2' : 
                              style === 'minimal' ? 'text-xl font-light text-gray-800 mb-4 pb-2 border-b border-gray-300' :
                              'text-2xl font-bold text-gray-800 mb-4 border-b-2 border-blue-600 pb-2';
            
            const titleText = style === 'classic' ? 'PROFESSIONAL EXPERIENCE' : 
                             style === 'minimal' ? 'Experience' : 'Work Experience';
            
            return `
                <section class="mb-8">
                    <h2 class="${titleClass}">${titleText}</h2>
                    <div class="space-y-6">
                        ${resumeData.experience.map(exp => `
                            <div class="${style === 'modern' ? 'relative pl-8' : style === 'classic' ? 'text-center' : ''}">
                                ${style === 'modern' ? `
                                    <div class="absolute left-0 top-2 w-4 h-4 bg-blue-600 rounded-full"></div>
                                    <div class="absolute left-2 top-6 w-0.5 h-full bg-gray-300"></div>
                                ` : ''}
                                <div>
                                    <div class="flex justify-between items-start mb-2">
                                        <div>
                                            <h3 class="text-xl font-semibold text-gray-800">${exp.position}</h3>
                                            <p class="text-lg ${style === 'modern' ? 'text-blue-600' : 'text-gray-600'} font-medium">${exp.company}</p>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-sm text-gray-600">${formatDate(exp.startDate)} - ${exp.current ? 'Present' : formatDate(exp.endDate)}</p>
                                        </div>
                                    </div>
                                    ${exp.description ? `<p class="text-gray-700 leading-relaxed whitespace-pre-line">${exp.description}</p>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </section>
            `;
        }

        function renderEducation(style = 'modern') {
            if (!resumeData.education.length) return '';
            
            const titleClass = style === 'classic' ? 'text-2xl font-bold text-gray-800 mb-4 text-center border-b-2 border-gray-800 pb-2' : 
                              style === 'minimal' ? 'text-xl font-light text-gray-800 mb-4 pb-2 border-b border-gray-300' :
                              'text-2xl font-bold text-gray-800 mb-4 border-b-2 border-blue-600 pb-2';
            
            const titleText = style === 'classic' ? 'EDUCATION' : 'Education';
            
            return `
                <section class="mb-8">
                    <h2 class="${titleClass}">${titleText}</h2>
                    <div class="space-y-4">
                        ${resumeData.education.map(edu => `
                            <div class="${style === 'classic' ? 'text-center' : 'flex justify-between items-start'}">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800">${edu.degree} in ${edu.field}</h3>
                                    <p class="${style === 'modern' ? 'text-blue-600' : 'text-gray-600'} font-medium">${edu.institution}</p>
                                    ${edu.gpa ? `<p class="text-sm text-gray-600">GPA: ${edu.gpa}</p>` : ''}
                                </div>
                                <div class="${style === 'classic' ? '' : 'text-right'}">
                                    <p class="text-sm text-gray-600">${formatDate(edu.startDate)} - ${formatDate(edu.endDate)}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </section>
            `;
        }

        function renderSkills(style = 'modern') {
            if (!resumeData.skills.length) return '';
            
            const titleClass = style === 'classic' ? 'text-2xl font-bold text-gray-800 mb-4 text-center border-b-2 border-gray-800 pb-2' : 
                              style === 'minimal' ? 'text-xl font-light text-gray-800 mb-4 pb-2 border-b border-gray-300' :
                              'text-2xl font-bold text-gray-800 mb-4 border-b-2 border-blue-600 pb-2';
            
            return `
                <section class="mb-8">
                    <h2 class="${titleClass}">Skills</h2>
                    <div class="${style === 'minimal' ? 'space-y-4' : 'grid grid-cols-1 md:grid-cols-2 gap-6'}">
                        ${['Technical', 'Soft Skills', 'Languages', 'Tools'].map(category => {
                            const categorySkills = resumeData.skills.filter(skill => skill.category === category);
                            if (categorySkills.length === 0) return '';
                            
                            return `
                                <div>
                                    <h3 class="font-semibold text-gray-700 mb-2">${category}</h3>
                                    <div class="flex flex-wrap gap-2">
                                        ${categorySkills.map(skill => `
                                            <span class="${style === 'minimal' ? 'text-gray-700' : 'bg-gray-100 text-gray-800'} px-2 py-1 rounded text-sm">
                                                ${skill.name} (${skill.level})
                                            </span>
                                        `).join('')}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </section>
            `;
        }

        function renderProjects(style = 'modern') {
            if (!resumeData.projects || !resumeData.projects.length) return '';
            
            const titleClass = style === 'classic' ? 'text-2xl font-bold text-gray-800 mb-4 text-center border-b-2 border-gray-800 pb-2' : 
                              style === 'minimal' ? 'text-xl font-light text-gray-800 mb-4 pb-2 border-b border-gray-300' :
                              'text-2xl font-bold text-gray-800 mb-4 border-b-2 border-blue-600 pb-2';
            
            const titleText = style === 'classic' ? 'PROJECTS' : 'Projects';
            
            return `
                <section class="mb-8">
                    <h2 class="${titleClass}">${titleText}</h2>
                    <div class="space-y-6">
                        ${resumeData.projects.map(project => `
                            <div class="${style === 'modern' ? 'relative pl-8' : style === 'classic' ? 'text-center' : ''}">
                                ${style === 'modern' ? `
                                    <div class="absolute left-0 top-2 w-4 h-4 bg-blue-600 rounded-full"></div>
                                    <div class="absolute left-2 top-6 w-0.5 h-full bg-gray-300"></div>
                                ` : ''}
                                <div>
                                    <div class="flex justify-between items-start mb-2">
                                        <div>
                                            <h3 class="text-xl font-semibold text-gray-800">${project.name}</h3>
                                            <p class="text-lg ${style === 'modern' ? 'text-blue-600' : 'text-gray-600'} font-medium">${project.technologies}</p>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-sm text-gray-600">${project.date}</p>
                                        </div>
                                    </div>
                                    ${project.description ? `<p class="text-gray-700 leading-relaxed">${project.description}</p>` : ''}
                                    ${project.url ? `<p class="text-sm text-blue-600 mt-2"><a href="${project.url}" target="_blank">View Project</a></p>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </section>
            `;
        }

        function renderCertifications(style = 'modern') {
            if (!resumeData.certifications || !resumeData.certifications.length) return '';
            
            const titleClass = style === 'classic' ? 'text-2xl font-bold text-gray-800 mb-4 text-center border-b-2 border-gray-800 pb-2' : 
                              style === 'minimal' ? 'text-xl font-light text-gray-800 mb-4 pb-2 border-b border-gray-300' :
                              'text-2xl font-bold text-gray-800 mb-4 border-b-2 border-blue-600 pb-2';
            
            const titleText = style === 'classic' ? 'CERTIFICATIONS' : 'Certifications';
            
            return `
                <section class="mb-8">
                    <h2 class="${titleClass}">${titleText}</h2>
                    <div class="space-y-4">
                        ${resumeData.certifications.map(cert => `
                            <div class="${style === 'classic' ? 'text-center' : 'flex justify-between items-start'}">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800">${cert.name}</h3>
                                    <p class="${style === 'modern' ? 'text-blue-600' : 'text-gray-600'} font-medium">${cert.issuer}</p>
                                </div>
                                <div class="${style === 'classic' ? '' : 'text-right'}">
                                    <p class="text-sm text-gray-600">${cert.date}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </section>
            `;
        }

        function renderLanguages(style = 'modern') {
            if (!resumeData.languages || !resumeData.languages.length) return '';
            
            const titleClass = style === 'classic' ? 'text-2xl font-bold text-gray-800 mb-4 text-center border-b-2 border-gray-800 pb-2' : 
                              style === 'minimal' ? 'text-xl font-light text-gray-800 mb-4 pb-2 border-b border-gray-300' :
                              'text-2xl font-bold text-gray-800 mb-4 border-b-2 border-blue-600 pb-2';
            
            const titleText = style === 'classic' ? 'LANGUAGES' : 'Languages';
            
            return `
                <section class="mb-8">
                    <h2 class="${titleClass}">${titleText}</h2>
                    <div class="flex flex-wrap gap-4">
                        ${resumeData.languages.map(lang => `
                            <div class="flex items-center gap-2">
                                <span class="font-medium text-gray-800">${lang.name}</span>
                                <span class="text-sm text-gray-600">(${lang.proficiency})</span>
                            </div>
                        `).join('')}
                    </div>
                </section>
            `;
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
        }

        // PDF export functions
        // Enhanced PDF export with exact preview matching
        async function exportToPDF() {
            if (!resumeData.fullName) {
                showToast('Please fill in your name before exporting.', 'error');
                return;
            }

            try {
                showToast('Generating PDF...', 'loading');
                
                // First, update the resume preview to ensure all data is current
                updateResumePreview();
                
                // Wait for the preview to update
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const element = document.getElementById('resume-content');
                if (!element) {
                    throw new Error('Resume content not found');
                }

                // Get the exact computed styles from the original element
                const originalStyle = window.getComputedStyle(element);
                
                // Create a clone for PDF generation
                const elementClone = element.cloneNode(true);
                elementClone.id = 'resume-content-pdf';
                
                // Apply EXACT styles from original element
                elementClone.style.cssText = originalStyle.cssText;
                
                // Override specific properties for PDF generation
                Object.assign(elementClone.style, {
                    position: 'absolute',
                    left: '-9999px',
                    top: '0',
                    width: '794px', // A4 width at 96 DPI
                    maxWidth: '794px',
                    minWidth: '794px',
                    margin: '0',
                    padding: '0',
                    background: 'white',
                    overflow: 'visible',
                    transform: 'none',
                    transformOrigin: 'top left'
                });

                // Add clone to body temporarily
                document.body.appendChild(elementClone);

                // Copy all computed styles to all child elements
                const copyStyles = (source, target) => {
                    const sourceElements = source.querySelectorAll('*');
                    const targetElements = target.querySelectorAll('*');
                    
                    sourceElements.forEach((sourceEl, index) => {
                        const targetEl = targetElements[index];
                        if (targetEl) {
                            const computedStyle = window.getComputedStyle(sourceEl);
                            targetEl.style.cssText = computedStyle.cssText;
                        }
                    });
                };

                copyStyles(element, elementClone);

                // Re-initialize Lucide icons in the clone
                lucide.createIcons();

                // Wait for rendering and icons to load
                await new Promise(resolve => setTimeout(resolve, 1500));

                // Force multiple layout recalculations
                elementClone.offsetHeight;
                await new Promise(resolve => setTimeout(resolve, 100));
                elementClone.offsetHeight;

                // Generate canvas with PRECISE settings
                const canvas = await html2canvas(elementClone, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    logging: false,
                    width: 794,
                    height: elementClone.scrollHeight,
                    windowWidth: 794,
                    windowHeight: 1123,
                    x: 0,
                    y: 0,
                    scrollX: 0,
                    scrollY: 0,
                    foreignObjectRendering: true,
                    imageTimeout: 20000,
                    removeContainer: false,
                    onclone: function(clonedDoc) {
                        // Additional style preservation in clone
                        const clonedElement = clonedDoc.getElementById('resume-content-pdf');
                        if (clonedElement) {
                            // Ensure gradient backgrounds are preserved
                            const gradients = clonedElement.querySelectorAll('.bg-gradient-to-r');
                            gradients.forEach(el => {
                                if (el.classList.contains('from-blue-600') && el.classList.contains('to-blue-800')) {
                                    el.style.background = 'linear-gradient(to right, #2563eb, #1e40af)';
                                }
                                if (el.classList.contains('from-purple-600') && el.classList.contains('via-pink-600') && el.classList.contains('to-red-600')) {
                                    el.style.background = 'linear-gradient(to right, #9333ea, #db2777, #dc2626)';
                                }
                            });
                        }
                    }
                });

                // Remove clone
                document.body.removeChild(elementClone);

                // Create PDF with A4 dimensions
                const { jsPDF } = window.jspdf;
                const imgData = canvas.toDataURL('image/png', 1.0);
                
                // A4 dimensions in mm
                const pdfWidth = 210;
                const pdfHeight = 297;
                
                // Calculate image dimensions to fit A4
                const imgWidth = canvas.width;
                const imgHeight = canvas.height;
                const aspectRatio = imgWidth / imgHeight;
                
                let scaledWidth, scaledHeight;
                if (aspectRatio > (pdfWidth / pdfHeight)) {
                    scaledWidth = pdfWidth * 0.94; // 6% margin
                    scaledHeight = scaledWidth / aspectRatio;
                } else {
                    scaledHeight = pdfHeight * 0.94; // 6% margin
                    scaledWidth = scaledHeight * aspectRatio;
                }
                
                // Center the image on the page
                const x = (pdfWidth - scaledWidth) / 2;
                const y = 8; // Small top margin

                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                pdf.addImage(imgData, 'PNG', x, y, scaledWidth, scaledHeight);
                pdf.save(`${resumeData.fullName.replace(/\s+/g, '_')}_Resume_${Date.now()}.pdf`);

                showToast('Resume exported successfully!', 'success');
            } catch (error) {
                console.error('PDF export error:', error);
                showToast('Failed to export PDF. Please try again.', 'error');
            }
        }

        function printResume() {
            if (!resumeData.fullName) {
                showToast('Please fill in your name before printing.', 'error');
                return;
            }

            window.print();
        }

        // Save and load functions
        function saveResume() {
            if (!resumeData.fullName || !resumeData.email) {
                showToast('Please fill in at least your name and email before saving.', 'error');
                return;
            }

            const savedResumes = JSON.parse(localStorage.getItem('savedResumes') || '[]');
            const resume = {
                ...resumeData,
                id: Date.now(),
                savedAt: new Date().toISOString()
            };
            
            savedResumes.push(resume);
            localStorage.setItem('savedResumes', JSON.stringify(savedResumes));
            
            showToast('Resume saved successfully!', 'success');
            updateResumeCount();
        }

        function loadSavedResumes() {
            const modal = document.getElementById('saved-resumes-modal');
            const list = document.getElementById('saved-resumes-list');
            const savedResumes = JSON.parse(localStorage.getItem('savedResumes') || '[]');
            
            if (savedResumes.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center py-8">No saved resumes yet</p>';
            } else {
                list.innerHTML = savedResumes.map(resume => `
                    <div class="flex items-center justify-between p-4 border rounded-lg">
                        <div>
                            <h3 class="font-semibold">${resume.title}</h3>
                            <p class="text-sm text-gray-600">${resume.fullName || 'No name'}</p>
                            <p class="text-xs text-gray-500">Saved: ${new Date(resume.savedAt).toLocaleDateString()}</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="loadResume(${resume.id})" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">Load</button>
                            <button onclick="deleteResume(${resume.id})" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700">Delete</button>
                        </div>
                    </div>
                `).join('');
            }
            
            modal.classList.remove('hidden');
        }

        function closeSavedResumes() {
            document.getElementById('saved-resumes-modal').classList.add('hidden');
        }

        function loadResume(id) {
            const savedResumes = JSON.parse(localStorage.getItem('savedResumes') || '[]');
            const resume = savedResumes.find(r => r.id === id);
            
            if (resume) {
                resumeData = { ...resume };
                
                // Load data into form
                Object.keys(resumeData).forEach(key => {
                    if (key !== 'experience' && key !== 'education' && key !== 'skills' && key !== 'id' && key !== 'savedAt') {
                        const element = document.getElementById(key);
                        if (element) {
                            element.value = resumeData[key] || '';
                        }
                    }
                });
                
                renderExperienceList();
                renderEducationList();
                renderSkillsList();
                updateResumePreview();
                closeSavedResumes();
                showToast('Resume loaded successfully!', 'success');
            }
        }

        function deleteResume(id) {
            if (confirm('Are you sure you want to delete this resume?')) {
                let savedResumes = JSON.parse(localStorage.getItem('savedResumes') || '[]');
                savedResumes = savedResumes.filter(r => r.id !== id);
                localStorage.setItem('savedResumes', JSON.stringify(savedResumes));
                loadSavedResumes();
                updateResumeCount();
                showToast('Resume deleted successfully!', 'success');
            }
        }

        function updateResumeCount() {
            const savedResumes = JSON.parse(localStorage.getItem('savedResumes') || '[]');
            document.getElementById('resume-count').textContent = savedResumes.length;
        }

        // Toast notification
        function showToast(message, type = 'info') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            if (type === 'loading') {
                toast.innerHTML = `<div class="spinner"></div><span>${message}</span>`;
            } else {
                toast.innerHTML = `<span>${message}</span>`;
            }
            
            document.body.appendChild(toast);
            
            if (type !== 'loading') {
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
        }

        // Initialize with empty lists
        renderExperienceList();
        renderEducationList();
        renderSkillsList();
    </script>
</body>
</html>